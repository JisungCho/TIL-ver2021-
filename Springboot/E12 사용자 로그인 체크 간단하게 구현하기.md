# E12 사용자 로그인 체크 간단하게 구현하기

## 커스텀 어노테이션 인터페이스 만들기

```java
package kr.co.jisung.framework.data.web.bind.annotation;

import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

/**
 * 커스텀 어노테이션 만들기
 * @author jisun
 *
 */
@Target(ElementType.METHOD) // 어노테이션이 적용할 위치를 결정  , 현재는 메소드 선언시
@Retention(RetentionPolicy.RUNTIME) // 어떤 시점까지 어노테이션이 영향을 미치는지 , 현재는 컴파일 이후에도 JVM에 의해서 참조가 가능
@Documented // 문서에도 어노테이션의 정보가 표현
// 인터페이스를 만들어주는데 앞에 @ 표시를 붙이면 됨
public @interface RequestConfig { //등록수정 , 삭제에만 추가
	
	boolean loginCheck() default true;
}

```

## /save 부분에 커스텀 어노테이션 추가하기

```java
	@PutMapping("/save")
	@RequestConfig //커스텀 어노테이션 적용
	@ApiOperation(value = "등록/수정 처리", notes = "신규 게시물 등록 및 기준 게시물 수정처리")
	@ApiImplicitParams({ @ApiImplicitParam(name = "boardSeq", value = "게시물 번호", example = "1"),
			@ApiImplicitParam(name = "title", value = "제목", example = "spring"),
			@ApiImplicitParam(name = "contents", value = "내용", example = "spring 강좌") })
	public BaseResponse<Integer> save(BoardParameter parameter) {
		// 제목 필수 체크
		// StringUtils.isEmpty : java 문자 혹은 문자열 빈값 체크하는 방법
		if (StringUtils.isEmpty(parameter.getTitle())) {
			throw new BaseException(BaseResponseCode.VALIDATE_REQUIRED, new String[] { "title", "제목" });
		}
		// 내용 필수 체크
		if (StringUtils.isEmpty(parameter.getContents())) {
			throw new BaseException(BaseResponseCode.VALIDATE_REQUIRED, new String[] { "contents", "내용" });
		}
		boardService.save(parameter);
		return new BaseResponse<Integer>(parameter.getBoardSeq());
	}
```

## BaseHandler에서 어노테이션 적용 설정

```java
	//  매개변수 handler는 Dispatcher의 HandlerMapping 이 찾아준 컨트롤러의 메서드를 참조할 수 있는 HandlerMethod 객체
	@Override
	public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
		logger.info("preHandle requestURI : {}", request.getRequestURI());
		
		if(handler instanceof HandlerMethod) {
			HandlerMethod handlerMethod = (HandlerMethod) handler;
			logger.info("handlerMethod : {}",handlerMethod);
			//@RequestConfig 받아오기
			RequestConfig requestConfig = handlerMethod.getMethodAnnotation(RequestConfig.class);
			//메소드에 @RequestConfig가 없는경우
			if(requestConfig != null) {
				//로그인 체크가 필수인 경우
				if(requestConfig.loginCheck()) {
					throw new BaseException(BaseResponseCode.LOGIN_REQUIRED,new String[] {request.getRequestURI()});
				}
			}
		}
		return true;
	}
```

## ResponseCode에 LOGIN_REQUIRED추가

```JAVA
package kr.co.jisung.configuration.http;

/*
 * enum이란 enumerated type의 줄임말로
 * 멤버라 불리는 명명된 값의 집합을 이루는 자료형이다.
 * 즉, 열거형에 사용될 수 있는 특정한 값들을 정의해서 해당 값들만 사용할 수 있게 한다.
 * 참고로, 열거자 이름들은 일반적으로 해당 언어의 상수 역할을 하는 식별자이다.
 */

public enum BaseResponseCode {
	SUCCESS,
	ERROR,
	LOGIN_REQUIRED,
	DATA_IS_NULL,
	VALIDATE_REQUIRED,
	;
}

```

```properties
SUCESS = 정상적으로 처리되었습니다.
ERROR = 오류가 발생했습니다.
DATA_IS_NULL = 요청하신 {0} 데이터는 NULL입니다.
LOGIN_REQUIRED = 요청하신  {0} URL은 로그인이 필수 입니다.
VALIDATE_REQUIRED = {0}({1}) 필드는 필수로 입력하셔야 합니다.
```

