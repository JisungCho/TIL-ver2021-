# E15. 데이터 변환 핸들러

## 칼럼추가

DEL_YN 칼럼추가 CHAR(1)이면서 기본값은 N

## Board클래스 수정

```java
package kr.co.jisung.mvc.domain;

import java.sql.Date;

import lombok.Data;

//getter , setter
@Data
public class Board {
	private int boardSeq;
	private BoardType boardType;
	private String title;
	private String contents;
	private Date regDate;
	private boolean delYn;
}

```

## BoardParameter 클래스 수정

```java
package kr.co.jisung.mvc.parameter;

import java.sql.Date;

import kr.co.jisung.mvc.domain.BoardType;
import lombok.Data;

//파라미터와 Response는 클래스로 구별하는게 좋다
//getter , setter
@Data
public class BoardParameter {
	private int boardSeq;
	private BoardType boardType;
	private String title;
	private String contents;
	private boolean delYn;
	
	//기본 생성자
	public BoardParameter() {

	}

	public BoardParameter(String title, String contents) {
		this.title = title;
		this.contents = contents;
	}
	
	
}

```

## TypeHandler 

```java
package kr.co.jisung.configuration.mybatis.typehandler;

import java.sql.CallableStatement;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import org.apache.commons.lang3.BooleanUtils;
import org.apache.ibatis.type.JdbcType;
import org.apache.ibatis.type.TypeHandler;

public class StringValueBooleanTypeHandler implements TypeHandler<Boolean>{

	//Component -> DB 요청 시 사용 될 method
	@Override
	public void setParameter(PreparedStatement ps, int i, Boolean parameter, JdbcType jdbcType) throws SQLException {
		//boolean이 true일때 Y , false일때 N 의 값으로 바뀜
		ps.setString(i, BooleanUtils.toString(parameter, "Y", "N"));
	}

	//DB -> Component로 Data Read 시 사용 될 method
	@Override
	public Boolean getResult(ResultSet rs, String columnName) throws SQLException {
		return BooleanUtils.toBoolean(rs.getString(columnName));
	}

	//DB -> Component로 Data Read 시 사용 될 method
	@Override
	public Boolean getResult(ResultSet rs, int columnIndex) throws SQLException {
		return BooleanUtils.toBoolean(rs.getString(columnIndex));
	}

	
	//DB -> Component로 Data Read 시 사용 될 method
	@Override
	public Boolean getResult(CallableStatement cs, int columnIndex) throws SQLException {
		return BooleanUtils.toBoolean(cs.getString(columnIndex));
	}

}

```

## Board.xml

```xml
		<!-- 
		ResultMap을 만들기 위해서는 다음 설정을 수행해야 한다.
			type : 매핑될 클래스명을 작성한다.
			id : 외부에서 지정할 이름을 작성한다.
			내부에는 <result> 항목을 배치하여 데이터에 대한 실제 매핑 관계를 설정한다.
			
		Result 설정 항목은 다음과 같다.
				column : 불러올 데이터베이스 항목명을 작성한다.
				property : 불러온 항목을 저장할 클래스 내의 변수명을 작성한다.
				만약 데이터가 여러 개라면 컬렉션을 지정할 수 있는데, 이 때는 <collection> 항목을 배치하여 매핑 관계를 설정한다.

		Collection 설정 항목은 다음과 같다.
				column : 불러올 데이터베이스 항목명을 작성한다. 여기서는 하위 SQL을 실행하기 위한 항목을 작성한다.(일반적으로 PK로 작성)
				property : 불러온 항목을 저장할 클래스 내의 변수명을 작성한다.
				javaType : Collection의 형태를 작성한다. 내장된 별칭이 있으므로 java.util.List 또는 list 라고 작성해도 무방하다.
				ofType : Collection의 내용물의 형태를 작성한다. Quiz 클래스에 List<Choice>라고 되어 있으므로 Choice의 경로를 작성한다.
				select : 이 데이터는 quiz에 존재하지 않기 때문에 조회하는 구문이 따로 필요하므로 해당하는 조회 구문의 id를 작성한다.
		 -->
		<resultMap type="kr.co.jisung.mvc.domain.Board" id="getListResultMap">
			<result column="DEL_YN" property="delYn" typeHandler="kr.co.jisung.configuration.mybatis.typehandler.StringValueBooleanTypeHandler"></result>
		</resultMap>
		
		<!-- 변수는 pageRequst , parameter -->
		<select id="getList" parameterType="kr.co.jisung.framework.data.domain.PageRequestParameter" resultMap="getListResultMap">
		SELECT
			B.BOARD_SEQ,
			B.BOARD_TYPE,
			B.TITLE,
			B.CONTENTS,
			B.REG_DATE,
			B.DEL_YN
		FROM T_BOARD B
		<!--Mybatis에서 제공하는 where문법  -->
		<where>
		<!-- @를 사용하면 java static method 접근 가능 -->
		<!-- @패키지 + 클래스명@메소드명(파라메터 변수명)  -->
		<!-- null과 공백문자이면 false 나머지 true-->
		<!-- 컨텐츠가 리턴되면 단순히 “WHERE”만을 추가한다. 게다가 컨텐츠가 “AND”나 “OR”로 시작한다면 그 “AND”나 “OR”를 지워버린다 -->
			<if test="@org.apache.commons.lang3.StringUtils@isNotEmpty(parameter.keyword)">
				AND B.TITLE LIKE CONCAT ('%' , #{parameter.keyword} , '%')
			</if>
			<!-- null 체크 , 배열의 길이 체크 -->
			<!-- WHERE 일치하길 원하는 칼럼명 IN ( 조건1 ,조건2...) -->
			<!-- separator : 반복 되는 사이에 출력할 문자열 -->
			<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(parameter.boardTypes)">
				AND B.BOARD_TYPE IN (
					<foreach collection="parameter.boardTypes" item="value" separator=",">
						#{value}
					</foreach>
				)
			</if>
		</where>
		ORDER BY B.REG_DATE DESC
		<!-- 페이징 처리 -->
		LIMIT #{pageRequest.limit} , #{pageRequest.offset}
	</select>
```

```xml
	<!-- 
	useGeneratedKeys : (insert, update에만 적용) 자동생성 키를 받을때 true로 설정한다. (default: false)
	keyProperty : 리턴 될 key property 설정. 여러개를 사용한다면 ,(콤마)를 구분자로 나열한다.
 	-->
	<insert id="save" parameterType="kr.co.jisung.mvc.parameter.BoardParameter" useGeneratedKeys="true" keyProperty="boardSeq">
		INSERT INTO T_BOARD
		(
			BOARD_TYPE,
			TITLE,
			CONTENTS,
			REG_DATE,
			DEL_YN
		)
		VALUES
		(
			#{boardType.code},
			#{title},
			#{contents},
			NOW(),
			#{delYn, typeHandler=kr.co.jisung.configuration.mybatis.typehandler.StringValueBooleanTypeHandler}
		)
	</insert>	
```

