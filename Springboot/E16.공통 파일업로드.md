# E16.공통 파일업로드 

## properties 설정

```properties
spring.mvc.view.prefix= /WEB-INF/views/
spring.mvc.view.suffix= .jsp
```

## index.jsp 설정

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<form action="/file/save" method="post" enctype="multipart/form-data">
		<input type="file" name="uploadfile">
		
		<button type="submit">파일업로드</button>
	</form>
</body>
</html>
```

## pom.xml

```xml
		<!--톰캣 라이브러리 -->
		<dependency>
			<groupId>org.apache.tomcat.embed</groupId>
			<artifactId>tomcat-embed-jasper</artifactId>
		</dependency>
		<!-- jstl -->
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>jstl</artifactId>
		</dependency>
```

## FileController

```java
package kr.co.jisung.mvc.controller;

import java.io.File;
import java.io.IOException;
import java.util.Calendar;
import java.util.UUID;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import kr.co.jisung.configuration.GlobalConfig;
import kr.co.jisung.configuration.exception.BaseException;
import kr.co.jisung.configuration.http.BaseResponse;
import kr.co.jisung.configuration.http.BaseResponseCode;

/*
 * @Api : 해당 클래스가 Swagger리소스라는 것을 명시
 * @ApiOperation : 한 개의 operation을 선언
 * 								VALUE : API에 대한 간략한 설명
 * 								NOTES : 자세한 설명
 * @ApiParam : 파라미터에 대한 정보를 명시합니다.
 * 						value : 파라미터 정보를 작성합니다.
 * 						required : 필수 파라미터이면 true, 아니면 false를 작성합니다.
 * 						example :  테스트를 할 때 보여줄 예시를 작성합니다
*/
@RestController
@RequestMapping("/file")
@Api(tags = "파일 API")
public class FileController {
	Logger logger = LoggerFactory.getLogger(getClass());

	@Autowired
	private GlobalConfig config;

	/*
	 * 업로드 리턴
	 */
	@PostMapping("/save")
	@ApiOperation(value = "업로드", notes = "")
	public BaseResponse<Boolean> save(@RequestParam("uploadfile") MultipartFile multipartFile) {
		logger.debug("multipartfile : {}",multipartFile);
		//파일 필수 체크
		if(multipartFile == null || multipartFile.isEmpty()) {
			throw new BaseException(BaseResponseCode.DATA_IS_NULL);
		}
		logger.debug("config : {}", config);
		String uploadFilePath = config.getUploadFilePath();
		logger.debug("uploadFilePath : {}", uploadFilePath);
		
		//확장자 구하기
		String prefix = multipartFile.getOriginalFilename().substring(multipartFile.getOriginalFilename().lastIndexOf(".")+1,multipartFile.getOriginalFilename().length());
		//새로운 파일 이름
		String filename = UUID.randomUUID().toString() +"." +prefix; //파일명 완성
		
		//폴더가 있는지 없는지 확인
		File folder = new File(uploadFilePath);
		//폴더가 없다면
		if(!folder.isDirectory()) {
			folder.mkdirs(); //폴더만듬
		}
		
		String pathName = uploadFilePath + filename;
        //목적지
		File dest = new File(pathName);
		logger.debug("dest : {}", dest);
		try {
			multipartFile.transferTo(dest);
		} catch (IllegalStateException | IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return new BaseResponse<Boolean>(true);
	}
}

```

